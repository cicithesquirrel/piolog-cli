<!DOCTYPE>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Pioneers Game</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['corechart']}]}"></script>
</head>

<body>
    <h1>Pioneers Game</h1>
    <h2>Summary</h2>
    <p>The game started at {{startDate}} with the following players:</p>
    <ol>
        {{#playerOrder}}
        <li>{{.}}</li>
        {{/playerOrder}}
    </ol>
    <p>At {{endDate}}, during the {{stats.nthTurnLabel}} turn, the game ended {{#winner}}when {{winner}} has won{{/winner}}{{^winner}}without a winner {{/winner}}!</p>
    <p>The game podium was:</p>
    <ol>
        {{#podium}}
        <li>{{name}}: {{score}}</li>
        {{/podium}}
    </ol>
    <h2>Dice stats</h2>
    <script type="text/javascript">
        google.setOnLoadCallback(drawDiceStatsForAll);

        function drawDiceStatsForAll() {
            var chartDiv = document.getElementById('dice_stats_for_all')

            function getActual(dice) {
                return parseInt(chartDiv.children[dice - 2].getAttribute("data-actual"));
            }

            function getExpected(expectedOutOf36) {
                return parseInt(chartDiv.getAttribute("data-total")) * expectedOutOf36 / 36;
            }

            var data = google.visualization.arrayToDataTable([
                ['Dice', 'Actual', 'Expected'],
                ['2', getActual(2), getExpected(1)],
                ['3', getActual(3), getExpected(2)],
                ['4', getActual(4), getExpected(3)],
                ['5', getActual(5), getExpected(4)],
                ['6', getActual(6), getExpected(5)],
                ['7', getActual(7), getExpected(6)],
                ['8', getActual(8), getExpected(5)],
                ['9', getActual(9), getExpected(4)],
                ['10', getActual(10), getExpected(3)],
                ['11', getActual(11), getExpected(2)],
                ['12', getActual(12), getExpected(1)]]);

            var options = {
                title: 'Dice stats for all players',
                vAxis: {
                    title: 'Occurences'
                },
                hAxis: {
                    title: 'Dice'
                },
                seriesType: 'bars',
                series: {
                    1: {
                        type: 'line'
                    }
                }
            };

            var chart = new google.visualization.ComboChart(chartDiv);
            chart.draw(data, options);
        }
    </script>
    <div id="dice_stats_for_all" style="width: 900px; height: 500px;" data-total="{{stats.dice.totalNumber}}">
        {{#stats.dice.byScore}}
        <div data-actual="{{.}}"></div>
        {{/stats.dice.byScore}}
    </div>
</body>

</html>
