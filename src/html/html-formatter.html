<!DOCTYPE>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Pioneers Game</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <style type="text/css">
        body {
            margin-left: 1em;
        }

        h1 {
            text-align: center;
        }

        #podium li {
            line-height: 2em;
            margin-left: 1em;
        }

        #podium li i {
            color: white;
        }

        #podium li:nth-child(1) i {
            color: gold;
        }

        #podium li:nth-child(2) i {
            color: silver;
        }

        #podium li:nth-child(3) i {
            color: chocolate;
        }
    </style>
    <script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['corechart']}]}">
        /* */
    </script>
    <script type="text/javascript">
        function toGoogleChartDataTable(domTable) {
            var googleDataTable = new google.visualization.DataTable();

            var domHeaderLine = domTable.children[0].children[0];

            var converters = [];

            for (var domHeaderIndex = 0; domHeaderIndex < domHeaderLine.children.length; domHeaderIndex++) {
                var domHeaderCell = domHeaderLine.children[domHeaderIndex];
                var dataType = domHeaderCell.getAttribute('data-chart-type');
                googleDataTable.addColumn(dataType, domHeaderCell.textContent);
                if (dataType === 'number') {
                    converters[domHeaderIndex] = parseFloat;
                } else if (dataType === 'string') {
                    converters[domHeaderIndex] = null;
                }
            }

            for (var lineIndex = 0; lineIndex < domTable.children[1].childElementCount; lineIndex++) {
                var domLine = domTable.children[1].children[lineIndex];

                var googleDataLine = [];

                for (var domCellIndex = 0; domCellIndex < domLine.children.length; domCellIndex++) {
                    var domCell = domLine.children[domCellIndex];

                    var converterFunction = converters[domCellIndex];
                    if (converterFunction) {
                        googleDataLine.push(converterFunction(domCell.textContent));
                    } else {
                        googleDataLine.push(domCell.textContent);
                    }
                }

                googleDataTable.addRows([googleDataLine]);
            }

            return googleDataTable;
        }
    </script>
</head>

<body>
    <h1>Pioneers Game</h1>
    <h2>Summary</h2>
    <p>The game started at {{startDate}} with the following players:</p>
    <ol>
        {{#playerOrder}}
        <li>{{.}}</li>
        {{/playerOrder}}
    </ol>
    <p>At {{endDate}}, during the {{{stats.nthTurnLabelAsHtml}}} turn, the game ended {{#if winner}}when {{winner}} has won{{else}}without a winner {{/if}}!</p>
    {{#if winner}}
    <p>The game podium was:</p>
    <ol id="podium" class="fa-ul">
        {{#podium}}
        <li><i class="fa fa-li fa-trophy fa-2x"></i> {{name}}: {{score}}</li>
        {{/podium}}
    </ol>
    {{/if}}
    <h2>Dice stats</h2>
    <script type="text/javascript">
        google.setOnLoadCallback(function () {
            drawDiceStatsByPlayer();
        });

        function drawDiceStatsByPlayer() {

            var domTable = document.getElementById('dice_stats_by_player');

            var data = toGoogleChartDataTable(domTable);

            var options = {
                title: 'Dice stats by player',
                legend: {
                    position: 'top',
                    maxLines: 3
                },
                bar: {
                    groupWidth: '75%'
                },
                isStacked: true,
            };

            var chart = new google.visualization.ColumnChart(document.getElementById('dice_stats_by_player'));
            chart.draw(data, options);
        }
    </script>

    <table id="dice_stats_by_player" style="width: 900px; height: 500px;">
        <thead>
            <tr>
                <td data-chart-type="string">Dice</td>
                {{#playerOrder}}
                <td data-chart-type="number">{{.}}</td>
                {{/playerOrder}}
            </tr>
        </thead>
        <tbody>
            {{#stats.diceByPlayer}}
            <tr>
                <td>{{@index}}</td>
                {{#.}}
                <td>{{times}}</td>
                {{/.}}
            </tr>
            {{/stats.diceByPlayer}}
        </tbody>
    </table>
</body>

</html>
